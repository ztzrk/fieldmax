generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id            String        @id @default(uuid())
  fullName      String        @map("full_name")
  email         String        @unique
  password      String
  phoneNumber   String?       @unique @map("phone_number")
  role          UserRole      @default(USER)
  isVerified    Boolean       @default(false) @map("is_verified")
  createdAt     DateTime      @default(now()) @map("created_at")
  bookings      Booking[]
  reviews       Review[]
  sessions      Session[]
  profile       UserProfile?
  venues        Venue[]
  resetTokens   ResetToken[]
  reports       Report[]
  reportReplies ReportReply[]

  @@index([fullName])
  @@index([id])
  @@map("users")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model ResetToken {
  id        String   @id @default(uuid())
  token     String   @unique
  expires   DateTime
  userId    String   @map("user_id")
  createdAt DateTime @default(now()) @map("created_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("reset_tokens")
}

model UserProfile {
  userId             String   @id @default(uuid())
  profilePictureUrl  String?  @map("profile_picture_url")
  bio                String?
  address            String?
  updatedAt          DateTime @default(now()) @map("updated_at")
  companyDescription String?  @map("company_description")
  companyLogoUrl     String?  @map("company_logo_url")
  companyName        String?  @map("company_name")
  companyWebsite     String?  @map("company_website")
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("user_profiles")
}

model SportType {
  id     String  @id @default(uuid())
  name   String  @unique
  fields Field[]

  @@map("sport_types")
}

model Venue {
  id              String             @id @default(uuid())
  renterId        String             @map("renter_id")
  name            String
  address         String
  city            String?
  district        String?
  province        String?
  postalCode      String?            @map("postal_code")
  description     String?
  createdAt       DateTime           @default(now()) @map("created_at")
  status          VerificationStatus @default(DRAFT)
  rejectionReason String?            @map("rejection_reason")
  fields          Field[]
  schedules       VenueSchedule[]
  photos          VenuePhoto[]
  renter          User               @relation(fields: [renterId], references: [id], onDelete: Cascade)

  @@index([renterId])
  @@map("venues")
}

model VenueSchedule {
  id        String   @id @default(uuid())
  venueId   String   @map("venue_id")
  dayOfWeek Int      @map("day_of_week")
  openTime  DateTime @map("open_time") @db.Time(6)
  closeTime DateTime @map("close_time") @db.Time(6)
  venue     Venue    @relation(fields: [venueId], references: [id], onDelete: Cascade)

  @@map("venue_schedules")
}

model VenuePhoto {
  id         String   @id @default(uuid())
  venueId    String   @map("venue_id")
  url        String
  isFeatured Boolean  @default(false) @map("is_featured")
  createdAt  DateTime @default(now()) @map("created_at")
  venue      Venue    @relation(fields: [venueId], references: [id], onDelete: Cascade)

  @@map("venue_photos")
}

model Field {
  id              String             @id @default(uuid())
  venueId         String             @map("venue_id")
  sportTypeId     String             @map("sport_type_id")
  description     String?
  pricePerHour    Float              @map("price_per_hour")
  createdAt       DateTime           @default(now()) @map("created_at")
  status          VerificationStatus @default(PENDING)
  name            String
  isClosed        Boolean            @default(false) @map("is_closed")
  rejectionReason String?            @map("rejection_reason")
  bookings        Booking[]
  photos          FieldPhoto[]
  sportType       SportType          @relation(fields: [sportTypeId], references: [id])
  venue           Venue              @relation(fields: [venueId], references: [id], onDelete: Cascade)
  reviews         Review[]

  @@index([venueId])
  @@map("fields")
}

model FieldPhoto {
  id         String   @id @default(uuid())
  fieldId    String   @map("field_id")
  url        String
  isFeatured Boolean  @default(false) @map("is_featured")
  createdAt  DateTime @default(now()) @map("created_at")
  field      Field    @relation(fields: [fieldId], references: [id], onDelete: Cascade)

  @@map("field_photos")
}

model Booking {
  id          String        @id @default(uuid())
  userId      String        @map("user_id")
  fieldId     String        @map("field_id")
  bookingDate DateTime      @map("booking_date") @db.Date
  startTime   DateTime      @map("start_time") @db.Time(6)
  endTime     DateTime      @map("end_time") @db.Time(6)
  totalPrice  Float         @map("total_price")
  status      BookingStatus @default(PENDING)
  createdAt   DateTime      @default(now()) @map("created_at")
  field       Field         @relation(fields: [fieldId], references: [id])
  user        User          @relation(fields: [userId], references: [id])
  review      Review?
  payment     Payment?

  @@index([userId])
  @@map("bookings")
}

model Payment {
  id                 String        @id @default(uuid())
  bookingId          String        @unique @map("booking_id")
  amount             Float
  status             PaymentStatus @default(PENDING)
  snapToken          String?       @map("snap_token")
  paymentRedirectUrl String?       @map("payment_redirect_url")
  createdAt          DateTime      @default(now()) @map("created_at")
  updatedAt          DateTime      @updatedAt @map("updated_at")
  booking            Booking       @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@index([bookingId])
  @@map("payments")
}

model Review {
  id        String   @id @default(uuid())
  rating    Int
  comment   String?
  userId    String   @map("user_id")
  fieldId   String   @map("field_id")
  bookingId String   @unique @map("booking_id")
  createdAt DateTime @default(now()) @map("created_at")
  field     Field    @relation(fields: [fieldId], references: [id])
  user      User     @relation(fields: [userId], references: [id])
  booking   Booking  @relation(fields: [bookingId], references: [id])

  @@index([userId])
  @@index([fieldId])
  @@map("reviews")
}

model Session {
  id        String   @id
  userId    String   @map("user_id")
  expiresAt DateTime @map("expires_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("sessions")
}

enum UserRole {
  USER
  RENTER
  ADMIN
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum PaymentStatus {
  PENDING
  PAID
  EXPIRED
  FAILED
}

enum VerificationStatus {
  DRAFT
  PENDING
  APPROVED
  REJECTED
}

model Report {
  id          String         @id @default(uuid())
  userId      String         @map("user_id")
  subject     String
  description String
  category    ReportCategory @default(OTHER)
  status      ReportStatus   @default(PENDING)
  createdAt   DateTime       @default(now()) @map("created_at")
  updatedAt   DateTime       @default(now()) @updatedAt @map("updated_at")
  user        User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  replies     ReportReply[]

  @@index([userId])
  @@map("reports")
}

model ReportReply {
  id        String   @id @default(uuid())
  reportId  String   @map("report_id")
  senderId  String   @map("sender_id")
  message   String
  createdAt DateTime @default(now()) @map("created_at")

  report Report @relation(fields: [reportId], references: [id], onDelete: Cascade)
  sender User   @relation(fields: [senderId], references: [id], onDelete: Cascade)

  @@index([reportId])
  @@index([senderId])
  @@map("report_replies")
}

enum ReportStatus {
  PENDING
  RESOLVED
}

enum ReportCategory {
  SCAM
  TECHNICAL
  PAYMENT
  OTHER
}
