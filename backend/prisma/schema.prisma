generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                     String         @id @default(uuid())
  fullName               String         @map("full_name")
  email                  String         @unique
  password               String
  phoneNumber            String?        @unique @map("phone_number")
  role                   UserRole       @default(USER)
  createdAt              DateTime       @default(now()) @map("created_at")
  bookings               Booking[]
  receivedConversations  Conversation[] @relation("RenterConversations")
  initiatedConversations Conversation[] @relation("UserConversations")
  sentMessages           Message[]
  reviews                Review[]
  sessions               Session[]
  profile                UserProfile?
  venues                 Venue[]

  @@index([fullName])
  @@index([id])
  @@map("users")
}

model UserProfile {
  userId             String   @id @default(uuid())
  profilePictureUrl  String?  @map("profile_picture_url")
  bio                String?
  address            String?
  updatedAt          DateTime @default(now()) @map("updated_at")
  companyDescription String?  @map("company_description")
  companyLogoUrl     String?  @map("company_logo_url")
  companyName        String?  @map("company_name")
  companyWebsite     String?  @map("company_website")
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("user_profiles")
}

model SportType {
  id       String  @id @default(uuid())
  name     String  @unique
  fields   Field[]

  @@map("sport_types")
}

model Venue {
  id              String             @id @default(uuid())
  renterId        String             @map("renter_id")
  name            String
  address         String
  description     String?
  createdAt       DateTime           @default(now()) @map("created_at")
  status          VerificationStatus @default(DRAFT)
  rejectionReason String?            @map("rejection_reason")
  fields          Field[]
  schedules       VenueSchedule[]
  photos          VenuePhoto[]
  renter          User               @relation(fields: [renterId], references: [id], onDelete: Cascade)

  @@index([renterId])
  @@map("venues")
}

model VenueSchedule {
  id        String   @id @default(uuid())
  venueId   String   @map("venue_id")
  dayOfWeek Int      @map("day_of_week")
  openTime  DateTime @map("open_time") @db.Time(6)
  closeTime DateTime @map("close_time") @db.Time(6)
  venue     Venue    @relation(fields: [venueId], references: [id], onDelete: Cascade)

  @@map("venue_schedules")
}

model VenuePhoto {
  id         String   @id @default(uuid())
  venueId    String   @map("venue_id")
  url        String
  isFeatured Boolean  @default(false) @map("is_featured")
  createdAt  DateTime @default(now()) @map("created_at")
  venue      Venue    @relation(fields: [venueId], references: [id], onDelete: Cascade)

  @@map("venue_photos")
}

model Field {
  id                String             @id @default(uuid())
  venueId           String             @map("venue_id")
  sportTypeId       String             @map("sport_type_id")
  description       String?
  pricePerHour      Float              @map("price_per_hour")
  createdAt         DateTime           @default(now()) @map("created_at")
  status            VerificationStatus @default(PENDING)
  name              String
  isClosed          Boolean            @default(false) @map("is_closed")
  rejectionReason   String?            @map("rejection_reason")
  bookings          Booking[]
  conversations     Conversation[]
  photos            FieldPhoto[]
  schedules         FieldSchedule[]
  sportType         SportType          @relation(fields: [sportTypeId], references: [id])
  venue             Venue              @relation(fields: [venueId], references: [id], onDelete: Cascade)
  reviews           Review[]
  scheduleOverrides ScheduleOverride[]

  @@index([venueId])
  @@map("fields")
}

model FieldPhoto {
  id         String   @id @default(uuid())
  fieldId    String   @map("field_id")
  url        String
  isFeatured Boolean  @default(false) @map("is_featured")
  createdAt  DateTime @default(now()) @map("created_at")
  field      Field    @relation(fields: [fieldId], references: [id], onDelete: Cascade)

  @@map("field_photos")
}

model FieldSchedule {
  id        String   @id @default(uuid())
  fieldId   String   @map("field_id")
  dayOfWeek Int      @map("day_of_week")
  openTime  DateTime @map("open_time") @db.Time(6)
  closeTime DateTime @map("close_time") @db.Time(6)
  field     Field    @relation(fields: [fieldId], references: [id], onDelete: Cascade)

  @@map("field_schedules")
}

model ScheduleOverride {
  id           String    @id @default(uuid())
  fieldId      String    @map("field_id")
  overrideDate DateTime  @map("override_date") @db.Date
  isClosed     Boolean   @default(false) @map("is_closed")
  openTime     DateTime? @map("open_time") @db.Time(6)
  closeTime    DateTime? @map("close_time") @db.Time(6)
  field        Field     @relation(fields: [fieldId], references: [id], onDelete: Cascade)

  @@map("schedule_overrides")
}

model Booking {
  id                 String        @id @default(uuid())
  userId             String        @map("user_id")
  fieldId            String        @map("field_id")
  bookingDate        DateTime      @map("booking_date") @db.Date
  startTime          DateTime      @map("start_time") @db.Time(6)
  endTime            DateTime      @map("end_time") @db.Time(6)
  totalPrice         Float         @map("total_price")
  status             BookingStatus @default(PENDING)
  snapToken          String?       @map("snap_token")
  paymentRedirectUrl String?       @map("payment_redirect_url")
  paymentStatus      PaymentStatus @default(PENDING) @map("payment_status")
  createdAt          DateTime      @default(now()) @map("created_at")
  field              Field         @relation(fields: [fieldId], references: [id])
  user               User          @relation(fields: [userId], references: [id])

  @@index([userId])
  @@map("bookings")
}

model Review {
  id        String   @id @default(uuid())
  rating    Int
  comment   String?
  userId    String
  fieldId   String
  createdAt DateTime @default(now())
  field     Field    @relation(fields: [fieldId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@map("reviews")
}

model Session {
  id        String   @id
  userId    String   @map("user_id")
  expiresAt DateTime @map("expires_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("sessions")
}

model Conversation {
  id        String    @id @default(uuid())
  userId    String    @map("user_id")
  renterId  String    @map("renter_id")
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  fieldId   String    @map("field_id")
  venueId   String?
  field     Field     @relation(fields: [fieldId], references: [id], onDelete: Cascade)
  renter    User      @relation("RenterConversations", fields: [renterId], references: [id], onDelete: Cascade)
  user      User      @relation("UserConversations", fields: [userId], references: [id], onDelete: Cascade)
  messages  Message[]

  @@unique([userId, fieldId])
  @@index([userId, renterId])
  @@map("conversations")
}

model Message {
  id             String       @id @default(uuid())
  conversationId String       @map("conversation_id")
  senderId       String       @map("sender_id")
  content        String
  isRead         Boolean      @default(false) @map("is_read")
  createdAt      DateTime     @default(now()) @map("created_at")
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender         User         @relation(fields: [senderId], references: [id], onDelete: Cascade)

  @@index([senderId])
  @@map("messages")
}

enum UserRole {
  USER
  RENTER
  ADMIN
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum PaymentStatus {
  PENDING
  PAID
  EXPIRED
  FAILED
}

enum VerificationStatus {
  DRAFT
  PENDING
  APPROVED
  REJECTED
}
